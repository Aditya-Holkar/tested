<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Website Comprehensive Tester</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .card {
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-option {
        margin: 5px 0;
      }
      .progress {
        height: 20px;
        margin: 10px 0;
      }
      .results-table {
        font-size: 0.9rem;
      }
      .status-success {
        background-color: #d4edda !important;
      }
      .status-error {
        background-color: #f8d7da !important;
      }
      .status-warning {
        background-color: #fff3cd !important;
      }
      .tab-content {
        padding: 20px 0;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="bi bi-speedometer2"></i> Website Comprehensive Tester
        </a>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <div class="row">
        <!-- Left Column - Input Section -->
        <div class="col-md-4">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="bi bi-input-cursor"></i> Input Method
              </h5>
            </div>
            <div class="card-body">
              <ul class="nav nav-tabs" id="inputTab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link active"
                    id="manual-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#manual"
                    type="button"
                  >
                    <i class="bi bi-pencil"></i> Manual Input
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="extract-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#extract"
                    type="button"
                  >
                    <i class="bi bi-link-45deg"></i> Extract from Website
                  </button>
                </li>
              </ul>

              <div class="tab-content mt-3">
                <!-- Manual Input Tab -->
                <div
                  class="tab-pane fade show active"
                  id="manual"
                  role="tabpanel"
                >
                  <div class="mb-3">
                    <label class="form-label">Enter URLs (one per line):</label>
                    <textarea
                      class="form-control"
                      id="manualUrls"
                      rows="8"
                      placeholder="https://example.com/page1
https://example.com/page2
https://example.com/page3"
                    ></textarea>
                  </div>
                  <button class="btn btn-primary" onclick="loadManualUrls()">
                    <i class="bi bi-upload"></i> Load URLs
                  </button>
                </div>

                <!-- Extract Tab -->
                <div class="tab-pane fade" id="extract" role="tabpanel">
                  <div class="mb-3">
                    <label class="form-label">Website URL:</label>
                    <input
                      type="text"
                      class="form-control"
                      id="websiteUrl"
                      value="https://example.com"
                      placeholder="https://example.com"
                    />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Max Links to Extract:</label>
                    <input
                      type="number"
                      class="form-control"
                      id="maxLinks"
                      value="500"
                      min="10"
                      max="5000"
                    />
                  </div>
                  <button class="btn btn-primary" onclick="extractLinks()">
                    <i class="bi bi-link-45deg"></i> Extract Links
                  </button>
                  <button class="btn btn-warning ms-2" onclick="clearAll()">
                    <i class="bi bi-trash"></i> Clear All
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Links Preview -->
          <div class="card">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0"><i class="bi bi-list-ul"></i> Links Preview</h5>
            </div>
            <div class="card-body">
              <div id="linksPreview">
                <p class="text-muted">No links loaded yet.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Middle Column - Test Options -->
        <div class="col-md-3">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0"><i class="bi bi-gear"></i> Testing Options</h5>
            </div>
            <div class="card-body">
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="linkCheck"
                  checked
                />
                <label class="form-check-label ms-2" for="linkCheck">
                  <i class="bi bi-link"></i> Link Status Checking
                </label>
              </div>
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="buttonTest"
                  checked
                />
                <label class="form-check-label ms-2" for="buttonTest">
                  <i class="bi bi-ui-buttons"></i> Button Functionality Testing
                </label>
              </div>
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="performanceCheck"
                />
                <label class="form-check-label ms-2" for="performanceCheck">
                  <i class="bi bi-speedometer"></i> Performance Analysis
                </label>
              </div>
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accessibilityCheck"
                />
                <label class="form-check-label ms-2" for="accessibilityCheck">
                  <i class="bi bi-universal-access"></i> Accessibility Testing
                </label>
              </div>
              <div class="test-option">
                <input class="form-check-input" type="checkbox" id="seoCheck" />
                <label class="form-check-label ms-2" for="seoCheck">
                  <i class="bi bi-search"></i> SEO Analysis
                </label>
              </div>
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="spellCheck"
                />
                <label class="form-check-label ms-2" for="spellCheck">
                  <i class="bi bi-spellcheck"></i> Spelling & Grammar Check
                </label>
              </div>
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="fontCheck"
                />
                <label class="form-check-label ms-2" for="fontCheck">
                  <i class="bi bi-fonts"></i> Font Analysis
                </label>
              </div>
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="responsiveCheck"
                />
                <label class="form-check-label ms-2" for="responsiveCheck">
                  <i class="bi bi-phone"></i> Responsiveness Check
                </label>
              </div>
              <div class="test-option">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="browserCheck"
                />
                <label class="form-check-label ms-2" for="browserCheck">
                  <i class="bi bi-browser-chrome"></i> Cross-Browser
                  Compatibility
                </label>
              </div>

              <hr />

              <button
                class="btn btn-success w-100 mt-3"
                onclick="runTests()"
                id="runTestsBtn"
              >
                <i class="bi bi-play-fill"></i> Run Selected Tests
              </button>

              <div class="progress mt-3" id="progressBar" style="display: none">
                <div
                  class="progress-bar progress-bar-striped progress-bar-animated"
                  style="width: 100%"
                ></div>
              </div>
            </div>
          </div>

          <!-- Statistics -->
          <div class="card">
            <div class="card-header bg-secondary text-white">
              <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Statistics</h5>
            </div>
            <div class="card-body">
              <div id="statsContent">
                <p class="text-muted">No tests run yet.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Results -->
        <div class="col-md-5">
          <div class="card">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">
                <i class="bi bi-clipboard-data"></i> Test Results
              </h5>
            </div>
            <div class="card-body">
              <ul class="nav nav-tabs" id="resultsTab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link active"
                    id="summary-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#summary"
                    type="button"
                  >
                    Summary
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="testcases-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#testcases"
                    type="button"
                  >
                    Test Cases
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="links-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#links"
                    type="button"
                  >
                    Link Results
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="performance-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#performance"
                    type="button"
                  >
                    Performance
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="accessibility-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#accessibility"
                    type="button"
                  >
                    Accessibility
                  </button>
                </li>
              </ul>

              <div class="tab-content mt-3">
                <!-- Summary Tab -->
                <div
                  class="tab-pane fade show active"
                  id="summary"
                  role="tabpanel"
                >
                  <div id="summaryContent">
                    <p class="text-muted">Test results will appear here.</p>
                  </div>
                </div>

                <!-- Test Cases Tab -->
                <div class="tab-pane fade" id="testcases" role="tabpanel">
                  <div
                    class="table-responsive"
                    style="max-height: 400px; overflow-y: auto"
                  >
                    <table
                      class="table table-sm table-hover results-table"
                      id="testCasesTable"
                    >
                      <thead>
                        <tr>
                          <th>Test ID</th>
                          <th>Module</th>
                          <th>Status</th>
                          <th>Severity</th>
                        </tr>
                      </thead>
                      <tbody id="testCasesBody">
                        <!-- Test cases will be inserted here -->
                      </tbody>
                    </table>
                  </div>
                </div>

                <!-- Link Results Tab -->
                <div class="tab-pane fade" id="links" role="tabpanel">
                  <div
                    class="table-responsive"
                    style="max-height: 400px; overflow-y: auto"
                  >
                    <table
                      class="table table-sm table-hover results-table"
                      id="linkResultsTable"
                    >
                      <thead>
                        <tr>
                          <th>URL</th>
                          <th>Status</th>
                          <th>Time</th>
                        </tr>
                      </thead>
                      <tbody id="linkResultsBody">
                        <!-- Link results will be inserted here -->
                      </tbody>
                    </table>
                  </div>
                </div>

                <!-- Performance Tab -->
                <div class="tab-pane fade" id="performance" role="tabpanel">
                  <div id="performanceContent">
                    <p class="text-muted">
                      Performance results will appear here.
                    </p>
                  </div>
                </div>

                <!-- Accessibility Tab -->
                <div class="tab-pane fade" id="accessibility" role="tabpanel">
                  <div id="accessibilityContent">
                    <p class="text-muted">
                      Accessibility results will appear here.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Add this to the export buttons section in index.html -->
              <div class="mt-3">
                <button class="btn btn-primary" onclick="exportReport('json')">
                  <i class="bi bi-download"></i> Export JSON
                </button>
                <button
                  class="btn btn-success ms-2"
                  onclick="exportReport('csv')"
                >
                  <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV
                </button>
                <button
                  class="btn btn-info ms-2"
                  onclick="exportReport('html')"
                >
                  <i class="bi bi-file-earmark-text"></i> Export HTML
                </button>
                <!-- Add Excel export button -->
                <button
                  class="btn btn-warning ms-2"
                  onclick="exportReport('excel')"
                >
                  <i class="bi bi-file-excel"></i> Export Excel (Detailed)
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Global variables
      let extractedLinks = [];
      let testResults = {};

      // Load manual URLs
      function loadManualUrls() {
        const urlsText = document.getElementById("manualUrls").value;
        if (!urlsText.trim()) {
          alert("Please enter URLs in the text area");
          return;
        }

        const urls = urlsText
          .split("\n")
          .map((url) => url.trim())
          .filter((url) => url.length > 0)
          .map((url) => (url.startsWith("http") ? url : "http://" + url));

        if (urls.length === 0) {
          alert("No valid URLs found");
          return;
        }

        extractedLinks = urls;
        updateLinksPreview();
        alert(`Loaded ${urls.length} URLs`);
      }

      // Extract links from website
      function extractLinks() {
        const websiteUrl = document.getElementById("websiteUrl").value.trim();
        const maxLinks = document.getElementById("maxLinks").value;

        if (!websiteUrl) {
          alert("Please enter a website URL");
          return;
        }

        showProgress(true);

        fetch("/extract-links", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            website_url: websiteUrl,
            max_links: parseInt(maxLinks),
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            showProgress(false);
            if (data.success) {
              extractedLinks = data.links;
              updateLinksPreview();
              alert(data.message);
            } else {
              alert("Error: " + data.message);
            }
          })
          .catch((error) => {
            showProgress(false);
            alert("Error: " + error.message);
          });
      }

      // Run tests
      function runTests() {
        if (extractedLinks.length === 0) {
          alert("No links to test. Please load or extract URLs first.");
          return;
        }

        const testOptions = {
          link_check: document.getElementById("linkCheck").checked,
          button_test: document.getElementById("buttonTest").checked,
          performance_check:
            document.getElementById("performanceCheck").checked,
          accessibility_check:
            document.getElementById("accessibilityCheck").checked,
          seo_check: document.getElementById("seoCheck").checked,
          spell_check: document.getElementById("spellCheck").checked,
          font_check: document.getElementById("fontCheck").checked,
          responsive_check: document.getElementById("responsiveCheck").checked,
          browser_check: document.getElementById("browserCheck").checked,
        };

        showProgress(true);

        fetch("/run-tests", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            urls: extractedLinks,
            test_options: testOptions,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            showProgress(false);
            if (data.success) {
              testResults = data;
              updateResultsDisplay();
              updateStatistics(data.summary);
              alert(data.message);
            } else {
              alert("Error: " + data.message);
            }
          })
          .catch((error) => {
            showProgress(false);
            alert("Error: " + error.message);
          });
      }

      // Update the exportReport function in index.html
      function exportReport(format) {
        fetch("/export-report", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ format: format }),
        })
          .then((response) => {
            if (format === "json") {
              return response.json().then((data) => {
                if (data.success !== false) {
                  downloadJSON(data, "test-report.json");
                } else {
                  alert(data.message);
                }
              });
            } else if (format === "csv") {
              return response.blob().then((blob) => {
                downloadBlob(blob, "test-report.csv");
              });
            } else if (format === "html") {
              return response.blob().then((blob) => {
                downloadBlob(blob, "test-report.html");
              });
            } else if (format === "excel") {
              return response.blob().then((blob) => {
                downloadBlob(blob, "website_test_report.xlsx");
              });
            }
          })
          .catch((error) => {
            alert("Export error: " + error.message);
          });
      }
      // Clear all data
      function clearAll() {
        fetch("/clear-all", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              extractedLinks = [];
              testResults = {};
              updateLinksPreview();
              updateResultsDisplay();
              updateStatistics({});
              alert("All data cleared");
            }
          });
      }

      // Update links preview
      function updateLinksPreview() {
        const previewDiv = document.getElementById("linksPreview");

        if (extractedLinks.length === 0) {
          previewDiv.innerHTML =
            '<p class="text-muted">No links loaded yet.</p>';
          return;
        }

        let html = `<p><strong>Total links:</strong> ${extractedLinks.length}</p>`;
        html += '<div style="max-height: 200px; overflow-y: auto;">';
        html += '<ul class="list-group">';

        extractedLinks.slice(0, 20).forEach((link, index) => {
          html += `<li class="list-group-item py-1">${index + 1}. ${link}</li>`;
        });

        if (extractedLinks.length > 20) {
          html += `<li class="list-group-item py-1 text-muted">... and ${extractedLinks.length - 20} more links</li>`;
        }

        html += "</ul></div>";
        previewDiv.innerHTML = html;
      }

      // Update results display
      function updateResultsDisplay() {
        if (!testResults.summary) return;

        // Update summary
        const summaryDiv = document.getElementById("summaryContent");
        const summary = testResults.summary;

        let html = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h6 class="card-title">Overall Summary</h6>
                                <p><strong>Total URLs:</strong> ${summary.total_urls}</p>
                                <p><strong>Test Cases:</strong> ${summary.total_test_cases}</p>
                                <p><strong>Pass Rate:</strong> ${summary.pass_rate.toFixed(1)}%</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h6 class="card-title">Test Results</h6>
                                <p><strong>Link Tests:</strong> ${summary.link_results}</p>
                                <p><strong>Performance Tests:</strong> ${summary.performance_results}</p>
                                <p><strong>Accessibility Tests:</strong> ${summary.accessibility_results}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        summaryDiv.innerHTML = html;

        // Update test cases table
        if (testResults.test_cases) {
          const tbody = document.getElementById("testCasesBody");
          tbody.innerHTML = "";

          testResults.test_cases.forEach((testCase) => {
            const row = document.createElement("tr");
            row.className =
              testCase["Case Pass/Fail"] === "Pass"
                ? "status-success"
                : "status-error";

            row.innerHTML = `
                        <td>${testCase["Test ID"]}</td>
                        <td>${testCase["Module"]}</td>
                        <td><span class="badge ${testCase.Status === "Pass" ? "bg-success" : "bg-danger"}">${testCase.Status}</span></td>
                        <td><span class="badge ${getSeverityBadge(testCase.Severity)}">${testCase.Severity}</span></td>
                    `;
            tbody.appendChild(row);
          });
        }
      }

      // Update statistics
      function updateStatistics(stats) {
        const statsDiv = document.getElementById("statsContent");

        if (!stats.total_urls) {
          statsDiv.innerHTML = '<p class="text-muted">No tests run yet.</p>';
          return;
        }

        let html = `
                <p><strong>Total URLs:</strong> ${stats.total_urls}</p>
                <p><strong>Test Cases:</strong> ${stats.total_test_cases}</p>
                <p><strong>Passed:</strong> ${stats.passed_test_cases}</p>
                <p><strong>Failed:</strong> ${stats.failed_test_cases}</p>
                <div class="progress mt-2">
                    <div class="progress-bar bg-success" style="width: ${stats.pass_rate}%">${stats.pass_rate.toFixed(1)}%</div>
                </div>
            `;
        statsDiv.innerHTML = html;
      }

      // Helper functions
      function showProgress(show) {
        const progressBar = document.getElementById("progressBar");
        const runBtn = document.getElementById("runTestsBtn");

        if (show) {
          progressBar.style.display = "block";
          runBtn.disabled = true;
          runBtn.innerHTML =
            '<i class="bi bi-hourglass-split"></i> Running Tests...';
        } else {
          progressBar.style.display = "none";
          runBtn.disabled = false;
          runBtn.innerHTML =
            '<i class="bi bi-play-fill"></i> Run Selected Tests';
        }
      }

      function getSeverityBadge(severity) {
        switch (severity) {
          case "Critical":
            return "bg-danger";
          case "High":
            return "bg-warning";
          case "Medium":
            return "bg-info";
          case "Low":
            return "bg-secondary";
          default:
            return "bg-light text-dark";
        }
      }

      function downloadJSON(data, filename) {
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Helper function to download blob
      function downloadBlob(blob, filename) {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }

      function downloadHTML(html, filename) {
        const blob = new Blob([html], { type: "text/html" });
        downloadBlob(blob, filename);
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        updateLinksPreview();
      });
    </script>
  </body>
</html>
